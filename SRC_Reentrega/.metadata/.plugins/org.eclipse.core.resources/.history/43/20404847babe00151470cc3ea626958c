package pr2r;


import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.math.BigDecimal;
import java.util.Scanner;
import java.util.Vector;
import com.csvreader.CsvWriter;
import org.apache.commons.cli.*;

public class main {

	
	
		
	public static void main(String[] args) {
		//parseo argumentos
		Options opciones=preparaFormatoOpciones();
		CommandLine cmd=parseaOpciones(opciones,args);
		boolean esAleatoria=false;
		boolean esLibreEscala=false;
		int numNodos=0;
		

		
		//muy improbable que la lista de argumentos devuelva null
		//pero por si acaso...
		if (cmd==null) 
		{			
			System.exit(1);
		}
		//compruebo los argumentos y tipo de red;
		//y recupero los argumentos de creación
		int[] unosArgumentos=null;
		esAleatoria=esAleatoria(cmd,unosArgumentos);
		esLibreEscala=esLibreEscala(cmd,unosArgumentos);	
		if (esAleatoria)
			ClaseAleatoria.aristasAleatoria(unosArgumentos[0], unosArgumentos[1]);
		else
			if (esLibreEscala)
				ClaseLibreEscala.libreDeEscala(unosArgumentos[0], unosArgumentos[1]);
			else
			{
				imprimirAyuda(opciones);
				System.exit(1);				
			};
		
		
		
		
	}
	
	static boolean esAleatoria(CommandLine cmd, int[] unosArgumentos)
	{
		return comprobador(0,cmd,unosArgumentos);
	}
	
	static boolean esLibreEscala (CommandLine cmd,int[] unosArgumentos)
	{
		return comprobador(1,cmd,unosArgumentos);
	}
	
	//cod puede ser 0 para aleatoria, 1 para libre escala
	static boolean  comprobador(int cod, CommandLine cmd,int[] unosArgumentos)
	{
		char[][] unasLetras={ {'t','n','p'}, {'t','n','m'}};
		String[] tipo={"aleatoria","libre"};
		boolean todoBien=true;
		boolean error=false;		
				
		//compruebo que todas los argumentos necesarios, están
		int i=0;
		while (todoBien && i<unasLetras[cod].length)
		{
		todoBien=cmd.hasOption(unasLetras[cod][i]);
		i++;
		}
		
		//compruebo si contiene la cadena tipo		
		error=((cmd.getOptionValue(unasLetras[cod][0]))!=tipo[cod]);
		
		//compruebo el valor de los argumentos sea mayor que 0
		int j=1;
		while (!error && j<unasLetras[cod].length)
		{
			int unNumero=Integer.valueOf(cmd.getOptionValue(unasLetras[cod][i]));
			error=(unNumero<0);
			j++;
		}
		
		//preparo parametros de retorno
		if (todoBien && !error)
		{
			int long_args=unasLetras[cod].length;
			unosArgumentos=new int[long_args];
			
			for (int k=0;k<long_args;k++)
				unosArgumentos[k]=Integer.valueOf(cmd.getOptionValue(unasLetras[cod][k]));			
		}
		
		return todoBien && !error;	
	}
	
	static void  imprimirAyuda(Options opciones)
	{
		// automatically generate the help statement
		HelpFormatter formatter = new HelpFormatter();
		formatter.printHelp( "pr2r", opciones);
	}
	//http://www.javaworld.com/article/2074849/core-java/processing-command-line-arguments-in-java--case-closed.html
	//https://commons.apache.org/proper/commons-cli/usage.html
	static  CommandLine parseaOpciones(Options opciones, String[] args)
	{
		CommandLine cmd=null;
		CommandLineParser parser = new DefaultParser();
		try 
		{
		cmd = parser.parse(opciones, args);
		}
		catch(Exception e)
		{
			System.err.println("No he podido parsear. Razón:" + e.getMessage() );
		}
		return cmd;
	}
	
	//http://www.javaworld.com/article/2074849/core-java/processing-command-line-arguments-in-java--case-closed.html
	//https://commons.apache.org/proper/commons-cli/usage.html
	static Options preparaFormatoOpciones()
	{
		
		Option tipoRed=OptionBuilder.withArgName("t")
						.hasArg()
						.withDescription("tipo de red a generar: aleatoria  o libre")
						.create("t");					
		
		Option numNodos=OptionBuilder.withArgName("n")
				.hasArg()
				.withDescription("número de nodos (en todas)")
				.create("n");
		
		Option prob=OptionBuilder.withArgName("p")
				.hasArg()
				.withDescription("probabilidad (aleatoria)")
				.create("p");
		
		Option mGrado=OptionBuilder.withArgName("m")
				.hasArg()
				.withDescription("nodos iniciales (libre escala)")
				.create("m");
		
		Options opciones= new Options();
		opciones.addOption(tipoRed);
		opciones.addOption(numNodos);
		opciones.addOption(prob);
		opciones.addOption(mGrado);
		return opciones;
	}
	/*
	public static void menu(){
		
		System.out.println("1 - Aleatoria");
		System.out.println("2 - Libre de escala");
		System.out.println("3 - Salir");
		System.out.print ("Elige la opcion: ");
	}
	*/
	public static void procesarOpcion(int opcion){
		int nodos, t, m;
		Scanner s = new Scanner(System.in);
		
		switch (opcion){
		case 1:
			System.out.println("Numero de nodos:");
			nodos = s.nextInt();
			ClaseAleatoria.aleatoria(nodos);
		break;
		case 2:
			System.out.println("Numero de nodos:");
			nodos = s.nextInt();
			m=3;
			ClaseLibreEscala.libreDeEscala(nodos,m); 
			ClaseLibreEscala.libreDeEscala(nodos,m+1);
		break;
		}
	}
	

	
	
	
}


	
